# Azure Deployment Plan for ConferenceApp Project
## **Goal**
Deploy the ConferenceApp project to Azure Container Apps in Sweden Central region using Azure Developer CLI (AZD).

## **Project Information**
**ConferenceApp**  
- **Stack**: ASP.NET Core 8.0 MVC with Entity Framework Core  
- **Type**: Conference management web application with session registration and approval workflow  
- **Containerization**: Dockerfile present  
- **Dependencies**: Azure SQL Database for data storage  
- **Hosting**: Azure Container Apps
- **Authentication**: ASP.NET Core Identity with role-based authorization
- **Features**: Session management, user registration, admin approval process

## **Azure Resources Architecture**
> **Install the mermaid extension in IDE to view the architecture.**

```mermaid
graph TD
%% Services
svcazurecontainerapps_conferenceapp["`Name: conferenceapp
Path: d:/repos/ClaudeFunctions
Language: dotnet`"]
subgraph "Compute Resources"
%% Resources
subgraph containerappenv["Azure Container Apps (ACA) Environment"]
azurecontainerapps_conferenceapp("`conferenceapp (Azure Container App)`")
end
containerappenv:::cluster
end
subgraph "Dependency Resources"
%% Dependency Resources
azuresqldatabase_conferencedatabase["`conference-database (Azure SQL Database)`"]
end
%% Relationships
svcazurecontainerapps_conferenceapp --> |"hosted on"| azurecontainerapps_conferenceapp
azurecontainerapps_conferenceapp -.-> |"secret"| azuresqldatabase_conferencedatabase
```

- The container app gets its image from the Azure Container Registry
- The container app connects to Azure SQL Database using connection string stored in Key Vault
- Application Insights monitors the application performance and logs

## **Recommended Azure Resources**
Application ConferenceApp:
- Hosting Service Type: Azure Container Apps
- SKU: Consumption (0.25 vCPU, 0.5 Gi memory) - Suitable for web applications with moderate traffic
- Configuration:
    - language: dotnet
    - Environment Variables: 
        - `ConnectionStrings__DefaultConnection` (from Key Vault)
        - `ASPNETCORE_ENVIRONMENT=Production`
    - dockerFilePath: ./Dockerfile
    - dockerContext: .
- Dependencies Resource:
    - Dependency Name: conference-database
    - SKU: Basic (5 DTU, 2GB storage) - Suitable for development and small production workloads
    - Service Type: Azure SQL Database
    - Connection Type: Connection string stored in Key Vault
    - Environment Variables: 
        - `ConnectionStrings__DefaultConnection`

## **Recommended Supporting Services**:
- Application Insights: For monitoring and logging
- User-Assigned Managed Identity: For secure access to resources
- Log Analytics Workspace: Centralized logging for all services
- Key Vault: Secure storage for database connection strings and secrets
- Container Registry: Store and manage container images

## **Recommended Security Configurations**:
- User-Assigned Managed Identity must have permissions into the Key Vault
- User-Assigned Managed Identity must be assigned to all supported resources
- AcrPull role assignment: User managed identity must have **AcrPull** role ("7f951dda-4ed3-4680-a7ca-43fe172d538d") assigned to the container registry
- SQL Database configured with Azure AD authentication
- Network security groups to restrict database access

## **Execution Step**
> **Below are the steps for Copilot to follow; ask Copilot to update or execute this plan. Add check list for the steps.**

Execution Steps:
1. âœ… Containerization:
    - âœ… Dockerfile exists at ./Dockerfile
    - âœ… .dockerignore configured for optimal build
    - âœ… Container build context: . (root directory)
    - Output: Docker artifacts ready for deployment

2. Create Azure Infrastructure Files for AZD:
    1. Provisioning tool: AZD. Expected files: azure.yaml, infra/main.bicep, infra/main.parameters.json
    2. Grab current subscriptionID, call tool `appmod-get-available-region-sku` to get available region and SKUs for Sweden Central
    3. Generate the missing expected files:
        - Call tool `appmod-get-iac-rules` to get the rules for file generation
        - Generate: azure.yaml, infra/main.bicep, infra/main.parameters.json
        - Call `get_errors` on generated files and iterate on any errors
    4. Configure bicep files for Sweden Central region deployment

3. Env setup for azd:
    1. Install AZ CLI and AZD if not installed
    2. Run 'azd env new conferenceapp-prod --no-prompt' to create environment
    3. Set required environment variables:
        - AZURE_SUBSCRIPTION_ID (user's subscription)
        - AZURE_LOCATION=swedencentral
        - AZURE_RESOURCE_GROUP=rg-conferenceapp-prod
    4. Create resource group in Sweden Central region

4. Deployment:
    1. Run `azd provision --preview --no-prompt` to validate infrastructure
    2. Run `azd up --no-prompt` for full deployment
    3. Validate deployment with `appmod-get-azd-app-logs`

5. Summarize Result:
    1. Use `appmod-summarize-result` tool
    2. Generate: .azure/summary.copilotmd

## **Progress Tracking**
- âœ… Containerization complete (Dockerfile found at ./Dockerfile)
- ðŸ”² Azure infrastructure files generation
- ðŸ”² Environment setup
- ðŸ”² Azure provisioning
- ðŸ”² Application deployment
- ðŸ”² Deployment validation

## **Tools Checklist**
- ðŸ”² appmod-analyze-repository
- ðŸ”² appmod-plan-generate-dockerfile (skipped - Dockerfile exists)
- ðŸ”² appmod-get-available-region-sku
- ðŸ”² appmod-get-iac-rules
- ðŸ”² appmod-summarize-result